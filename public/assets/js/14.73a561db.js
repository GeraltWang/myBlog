(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{545:function(s,a,n){"use strict";n.r(a);var t=n(12),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("blockquote",[n("p",[s._v("当下拉刷新和上拉加载组合使用时，可能会出现下拉刷洗发送了2次请求的行为。")])]),s._v(" "),n("h3",{attrs:{id:"原因"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[s._v("#")]),s._v(" 原因")]),s._v(" "),n("blockquote",[n("p",[s._v("究其原因，其实是List组件本身的问题。List 组件的 Load 事件是异步的并且在组件显示的时候会自动触发一次，但是如果请求的内容不足以填满显示区域，List 会继续触发 Load 事件，直到数据足以铺满屏幕，或者数据加载完成。")])]),s._v(" "),n("h3",{attrs:{id:"解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),n("blockquote",[n("p",[s._v("可以在 pull-refresh 组件的 刷新事件中先将 List 组件 的 finished 设置为 true，由于 List 组件的特性，在展示的时候会自动触发 Load 事件加载数据。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 下拉刷洗新代码\nconst onRefresh = () => {\n  // 1.清空数据\n  indexData.value = {};\n  productsData.value = [];\n  // 2.页码还原\n  page = 1;\n  // 3.触底加载状态还原\n  state.loading = false;\n  // 在这里将 List 的 finished 设置为true\n  state.finished = true;\n  // 4.重新发送请求\n  initIndexData();\n  initProductsData();\n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("blockquote",[n("p",[s._v("之后根据请求到的内容再判断 finished 的状态是 false 还是 true")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const initProductsData = async () => {\n  const { data } = await getProductList({\n    limit,\n    page,\n  });\n  if (data.status !== 200) {\n    return;\n  }\n  // 数据存储至商品列表\n  productsData.value.push(...data.data);\n  // 加载状态变更为false\n  state.loading = false;\n  // 判断是否已经加载完所有产品\n  if (data.data.length < limit) {\n    state.finished = true;\n    return;\n  } else {\n    state.finished = false;\n  }\n  // 变更页数，准备下次数据请求\n  page += 1;\n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("在用 Vue3 + Vant3 做项目的时候遇到的小问题，卡了我半小时，哈哈哈哈哈哈哈。")])])}),[],!1,null,null,null);a.default=e.exports}}]);